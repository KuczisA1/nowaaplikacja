<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bezpieczny odtwarzacz</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: #050505;
      color: #f8fafc;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    .app {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      padding: clamp(1rem, 3vw, 2rem);
      text-align: center;
    }
    .message {
      max-width: 720px;
      line-height: 1.5;
      font-size: clamp(1rem, 2.8vw, 1.1rem);
      color: #cbd5f5;
    }
    .message.loaded {
      color: #a5f3fc;
    }
    .player-wrap {
      position: relative;
      width: min(100vw, 100vh * (16/9));
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      background: #000;
      border-radius: clamp(12px, 3vw, 18px);
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.45);
      display: none;
    }
    .player-wrap.active {
      display: block;
    }
    iframe.player {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: #000;
    }
    .shield {
      position: absolute;
      pointer-events: auto;
      background: transparent;
      z-index: 3;
    }
    .shield-top {
      top: 0;
      left: 0;
      right: 0;
      height: clamp(60px, 8vh, 86px);
    }
    .controls {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .ctrl-btn {
      appearance: none;
      background: #0ea5e9;
      border: none;
      color: #0b1120;
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .ctrl-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(14, 165, 233, 0.25);
    }
    .ctrl-btn.secondary {
      background: #1f2937;
      color: #e0f2fe;
    }
    noscript {
      color: #fca5a5;
      font-size: 1rem;
    }
    @media (max-width: 640px) {
      .player-wrap {
        border-radius: 0;
        width: 100vw;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div id="message" class="message">
      Podaj parametry <code>id</code> oraz <code>type</code>, aby osadzić materiał.
    </div>
    <div id="playerWrap" class="player-wrap" aria-live="polite" aria-busy="true">
      <iframe id="player" class="player" title="Bezpieczny odtwarzacz" sandbox="allow-scripts allow-same-origin allow-presentation" loading="lazy"></iframe>
      <div class="shield shield-top" aria-hidden="true"></div>
    </div>
    <div class="controls" id="controls" hidden>
      <button type="button" id="fullscreenBtn" class="ctrl-btn">Pełny ekran</button>
      <button type="button" id="exitFullscreenBtn" class="ctrl-btn secondary" hidden>Wyjdź z pełnego ekranu</button>
    </div>
    <noscript>Aby odtwarzacz mógł zadziałać, włącz obsługę JavaScript w przeglądarce.</noscript>
  </div>
  <script>
    (function () {
      'use strict';

      const messageEl = document.getElementById('message');
      const wrapEl = document.getElementById('playerWrap');
      const frameEl = document.getElementById('player');
      const controlsEl = document.getElementById('controls');
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');

      const params = (() => {
        try {
          return new URLSearchParams(window.location.search);
        } catch (err) {
          console.error('URLSearchParams error', err);
          return new Map();
        }
      })();

      const rawId = (params.get('id') || '').trim();
      const rawType = (params.get('type') || '1').trim();

      const sanitizeId = (value) => value.replace(/[^0-9A-Za-z_-]/g, '');
      const mediaId = sanitizeId(rawId);
      const type = rawType === '2' ? '2' : '1';

      const error = (msg) => {
        messageEl.textContent = msg;
        messageEl.classList.remove('loaded');
        wrapEl.classList.remove('active');
        wrapEl.setAttribute('aria-busy', 'false');
        controlsEl.hidden = true;
        frameEl.removeAttribute('src');
      };

      if (!mediaId) {
        error('Brak prawidłowego parametru "id".');
        return;
      }

      const buildSrc = () => {
        if (type === '2') {
          return `https://drive.google.com/file/d/${encodeURIComponent(mediaId)}/preview`;
        }
        const base = `https://www.youtube.com/embed/${encodeURIComponent(mediaId)}`;
        const query = new URLSearchParams({
          rel: '0',
          modestbranding: '1',
          controls: '1',
          playsinline: '1',
          fs: '0',
          disablekb: '1',
          color: 'white'
        });
        return `${base}?${query.toString()}`;
      };

      const src = buildSrc();
      frameEl.src = src;
      wrapEl.classList.add('active');
      wrapEl.setAttribute('aria-busy', 'false');
      controlsEl.hidden = false;
      messageEl.classList.add('loaded');
      messageEl.textContent = type === '2'
        ? 'Odtwarzanie z Dysku Google (sandboxowane)'
        : 'Odtwarzanie z YouTube (sandboxowane)';

      if (window.location.search) {
        try {
          window.history.replaceState({}, document.title, window.location.pathname);
        } catch (err) {
          console.warn('History replace failed', err);
        }
      }

      const enterFullscreen = async () => {
        try {
          if (wrapEl.requestFullscreen) {
            await wrapEl.requestFullscreen();
          } else if (wrapEl.webkitRequestFullscreen) {
            wrapEl.webkitRequestFullscreen();
          }
        } catch (err) {
          console.warn('Fullscreen request failed', err);
        }
      };

      const exitFullscreen = async () => {
        try {
          if (document.exitFullscreen) {
            await document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          }
        } catch (err) {
          console.warn('Fullscreen exit failed', err);
        }
      };

      fullscreenBtn.addEventListener('click', enterFullscreen);
      exitFullscreenBtn.addEventListener('click', exitFullscreen);

      const updateFullscreenButtons = () => {
        const active = document.fullscreenElement === wrapEl || document.webkitFullscreenElement === wrapEl;
        fullscreenBtn.hidden = active;
        exitFullscreenBtn.hidden = !active;
      };

      document.addEventListener('fullscreenchange', updateFullscreenButtons);
      document.addEventListener('webkitfullscreenchange', updateFullscreenButtons);

      updateFullscreenButtons();

      const blockers = ['contextmenu', 'dragstart'];
      blockers.forEach((type) => {
        document.addEventListener(type, (event) => {
          event.preventDefault();
          event.stopPropagation();
        }, { capture: true });
      });

      document.addEventListener('keydown', (event) => {
        const blocked = (event.ctrlKey || event.metaKey) && ['s', 'p', 'u'].includes(event.key.toLowerCase());
        if (blocked || event.key === 'F12') {
          event.preventDefault();
          event.stopPropagation();
        }
      }, { capture: true });

      window.addEventListener('blur', () => {
        try {
          document.activeElement && document.activeElement.blur();
        } catch (_) {}
      });
    })();
  </script>
</body>
</html>
