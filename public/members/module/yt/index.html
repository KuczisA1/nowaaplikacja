<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bezpieczny odtwarzacz</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: #050505;
      color: #f8fafc;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    }
    body {
      overflow: hidden;
    }
    .app {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .message {
      position: absolute;
      inset: auto 50% 10% 50%;
      transform: translateX(-50%);
      max-width: min(92vw, 480px);
      padding: 1rem 1.25rem;
      background: rgba(15, 23, 42, 0.85);
      border-radius: 12px;
      line-height: 1.45;
      font-size: clamp(0.95rem, 2.4vw, 1.05rem);
      color: #fca5a5;
      display: none;
    }
    .player-wrap {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #000;
      overflow: hidden;
      display: none;
    }
    .player-wrap.active {
      display: block;
    }
    iframe.player {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: #000;
    }
    .shield,
    .shield-hit,
    .shield-bottom {
      position: absolute;
      pointer-events: auto;
      background: transparent;
      z-index: 3;
    }
    .shield-top {
      top: 0;
      left: 0;
      right: 0;
      height: clamp(110px, 12vh, 164px);
    }
    .shield-hit {
      left: 50%;
      transform: translateX(-50%);
      top: clamp(48px, 9vh, 122px);
      width: min(40vw, 420px);
      height: clamp(26px, 5vh, 42px);
    }
    .shield-bottom {
      bottom: 0;
      right: 0;
      width: clamp(110px, 18vw, 220px);
      height: clamp(70px, 14vh, 120px);
    }
    noscript {
      color: #fca5a5;
      font-size: 1rem;
    }
    @media (max-width: 640px) {
      .player-wrap {
        border-radius: 0;
        width: 100vw;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div id="message" class="message" role="alert"></div>
    <div id="playerWrap" class="player-wrap" aria-live="polite" aria-busy="true">
      <iframe id="player" class="player" title="Bezpieczny odtwarzacz" sandbox="allow-scripts allow-same-origin allow-presentation" loading="lazy"></iframe>
      <div class="shield shield-top" aria-hidden="true"></div>
      <div class="shield-hit" aria-hidden="true"></div>
      <div class="shield-bottom" aria-hidden="true"></div>
    </div>
    <noscript>Aby odtwarzacz mógł zadziałać, włącz obsługę JavaScript w przeglądarce.</noscript>
  </div>
  <script>
    (function () {
      'use strict';

      const messageEl = document.getElementById('message');
      const wrapEl = document.getElementById('playerWrap');
      const frameEl = document.getElementById('player');

      const params = (() => {
        try {
          return new URLSearchParams(window.location.search);
        } catch (err) {
          console.error('URLSearchParams error', err);
          return new Map();
        }
      })();

      const rawId = (params.get('id') || '').trim();
      const rawType = (params.get('type') || '1').trim();

      const sanitizeId = (value) => value.replace(/[^0-9A-Za-z_-]/g, '');
      const mediaId = sanitizeId(rawId);
      const type = rawType === '2' ? '2' : '1';

      const showError = (msg) => {
        if (!msg) return;
        messageEl.textContent = msg;
        messageEl.style.display = 'block';
        wrapEl.classList.remove('active');
        wrapEl.setAttribute('aria-busy', 'false');
        frameEl.removeAttribute('src');
      };

      if (!mediaId) {
        showError('Brak prawidłowego parametru "id".');
        return;
      }

      const buildSrc = () => {
        if (type === '2') {
          return `https://drive.google.com/file/d/${encodeURIComponent(mediaId)}/preview`;
        }
        const base = `https://www.youtube.com/embed/${encodeURIComponent(mediaId)}`;
        const query = new URLSearchParams({
          rel: '0',
          modestbranding: '1',
          controls: '1',
          playsinline: '1',
          fs: '0',
          disablekb: '1',
          color: 'white'
        });
        return `${base}?${query.toString()}`;
      };

      const src = buildSrc();
      frameEl.src = src;
      wrapEl.classList.add('active');
      wrapEl.setAttribute('aria-busy', 'false');
      messageEl.textContent = '';
      messageEl.style.display = 'none';

      if (window.location.search) {
        try {
          window.history.replaceState({}, document.title, '/');
        } catch (err) {
          console.warn('History replace failed', err);
        }
      }

      const blockers = ['contextmenu', 'dragstart'];
      blockers.forEach((type) => {
        document.addEventListener(type, (event) => {
          event.preventDefault();
          event.stopPropagation();
        }, { capture: true });
      });

      document.addEventListener('keydown', (event) => {
        const blocked = (event.ctrlKey || event.metaKey) && ['s', 'p', 'u'].includes(event.key.toLowerCase());
        if (blocked || event.key === 'F12') {
          event.preventDefault();
          event.stopPropagation();
        }
      }, { capture: true });

      window.addEventListener('blur', () => {
        try {
          document.activeElement && document.activeElement.blur();
        } catch (_) {}
      });
    })();
  </script>
</body>
</html>
